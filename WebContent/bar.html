<!DOCTYPE html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
<style>

  .bar{
    fill: steelblue;
  }

  .bar:hover{
    fill: brown;
  }

	.axis {
	  font: 10px sans-serif;
	}

	.axis path,
	.axis line {
	  fill: none;
	  stroke: #000;
	  shape-rendering: crispEdges;
	}

	</style>
</head>

<body>
<div class="alert alert-success" role="alert">
  <strong>Navigational Space</strong>
</div>
<div>
	<button type="button" onclick="controller(0)" class="btn btn-info">Bar1</button>
	<button type="button" onclick="controller(1)" class="btn btn-success">+</button>
	<button type="button" onclick="controller(-1)" class="btn btn-success">-</button>
</div>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
     var divide = 0;
     function controller(num){
    	 if (divide+num < 0) {
    		 alert("Cannot decrease");
    		 displayAllBar('test1',0);
    	 } else {
    		 divide += num;
    	 }
    	 displayAllBar('test1',divide);
     }
</script>

<script>
// set the dimensions of the canvas
var margin = {top: 20, right: 20, bottom: 70, left: 20},
    width = 600 - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom;


// set the ranges
var x = d3.scale.ordinal().rangeRoundBands([300, width], .05);

var y = d3.scale.linear().range([height, 0]);

// define the axis
var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom")


var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .ticks(10);
    
var lastSVG;

function displayAllBar(name , n){
	var svg;
	if (window.lastSVG) {
		lastSVG.selectAll("*").remove();
		svg = lastSVG;
		svg.attr("width", width + margin.left + margin.right)
    	.attr("height", (n+1) * (height + margin.top + margin.bottom));
	} else {
		// add the SVG element
		var svg = d3.select("body").append("svg")
	    	.attr("width", width + margin.left + margin.right)
	    	.attr("height", (n+1) * (height + margin.top + margin.bottom));

	}

	lastSVG = svg;
	
	// load the data
	d3.json("/DataTree/GeneratorServlet?model=BarChart&size=" + (n+1), function(error, data) {
		data.forEach(function(d) {
	   	 	d.children.forEach( function(dtemp){
	   	 		dtemp.name = dtemp.name;
	   	 	    dtemp.count = +dtemp.count;
	   	 	} )
		});
		
    	for (var j = 0; j <= n ; ++j){
    		//write the info of the data
    		var canvasY = j * (height +  margin.top + margin.bottom) + margin.top ;
    		
    	  	  var canvas = svg.append("g").attr("transform", 
    	  	          "translate(" + margin.left + "," + canvasY  + ")");
    	  		
    	  	  var border = canvas.append("rect").attr("x", -1 * margin.left).attr("y",-1 * margin.top)
    	  		  		.attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom)
    	  		  		.attr('fill', 'rgba(0,0,0,0)').attr('stroke', '#2378ae').attr('stroke-width', '3');
    	  		
    	  	  var textName = canvas.append("text").attr("x",margin.left).attr("y",margin.top + 20)
    	  			.attr("font-family","sans-serif").text(data[j].name);
    	      
    	      var textRange = canvas.append("text").attr("x",margin.left).attr("y",margin.top + 70)
  					.attr("font-family","sans-serif").text("Row - Range:    " + data[j].rowRange);
    	      
    	      var textSubCat = canvas.append("text").attr("x",margin.left).attr("y",margin.top + 120)
				.attr("font-family","sans-serif").text("Sub-Category:    " + data[j].subCat);

    	      var textSubCat = canvas.append("text").attr("x",margin.left).attr("y",margin.top + 170)
				.attr("font-family","sans-serif").text("Size:    " + data[j].size);
    	      
    	  	  displayBar(canvas,data[j].children);
    	  	
    	}
    	
	})
	
	
}


function displayBar(svg, data){
	
	  // scale the range of the data
	  x.domain(data.map(function(d) { return d.name; }));
	  y.domain([0, d3.max(data, function(d) { return d.count})]);

	  // add axis
	  svg.append("g")
	      .attr("class", "x axis")
	      .attr("transform", "translate(0," + height + ")")
	      .call(xAxis)
	    .selectAll("text")
	      .style("text-anchor", "end")
	      .attr("dx", "-.8em")
	      .attr("dy", "-.55em")
	      .attr("transform", "rotate(-90)" );

	  svg.append("g")
	      .attr("class", "y axis")
	      .attr("transform", "translate(300,0)")
	      .call(yAxis)
	    .append("text")
	      .attr("transform", "rotate(-90)")
	      .attr("y", 5)
	      .attr("dy", ".71em")
	      .style("text-anchor", "end")
	      .text("Tuples");


	  // Add bar chart
	  svg.selectAll("bar")
	      .data(data)
	    .enter().append("rect")
	      .attr("class", "bar")
	      .attr("x", function(d) { return x(d.name); })
	      .attr("width", x.rangeBand())
	      .attr("y", function(d) { return y(d.count); })
	      .attr("height", function(d) { return height - y(d.count); });

}

</script>

</body>